<html>
    <head>
        <title>Crowd Navigation</title>
        <script src='/_ah/channel/jsapi'></script>
        <script src="http://static.opentok.com/webrtc/v2.0/js/TB.min.js" ></script>
        <link rel="stylesheet" type="text/css" href="css/common.css">
    </head>
    <body>
        <script src="/js/jquery-2.0.3.min.js" type="text/javascript" ></script>
        <script type="text/javascript">
        var apiKey    = "44596572";
        var sessionId = "1_MX40NDU5NjU3Mn5-VHVlIERlYyAzMSAxNzozNjoxOCBQU1QgMjAxM34wLjY2MDAzODY1fg";
        var token     = "T1==cGFydG5lcl9pZD00NDU5NjU3MiZzZGtfdmVyc2lvbj10YnJ1YnktdGJyYi12MC45MS4yMDExLTAyLTE3JnNpZz1iYjdiNjM0ZWU1NjJkZjgyNzk2MDMwNzVlYmNiZGQxODM0YzRmNGUyOnJvbGU9cHVibGlzaGVyJnNlc3Npb25faWQ9MV9NWDQwTkRVNU5qVTNNbjUtVkhWbElFUmxZeUF6TVNBeE56b3pOam94T0NCUVUxUWdNakF4TTM0d0xqWTJNREF6T0RZMWZnJmNyZWF0ZV90aW1lPTEzODg1NDAyMDAmbm9uY2U9MC44OTQxNjI0MDg0MDU5NjYzJmV4cGlyZV90aW1lPTEzODkxNDUwMDAmY29ubmVjdGlvbl9kYXRhPQ==";
        
		  function sessionConnectedHandler (event) {
		     subscribeToStreams(event.streams);
		  }
		  function subscribeToStreams(streams) {
		    for (var i = 0; i < streams.length; i++) {
		        var stream = streams[i];
		        if (stream.connection.connectionId 
		               != session.connection.connectionId) {
		            session.subscribe(stream);
		        }
		    }
		  }
		  function streamCreatedHandler(event) {
		    subscribeToStreams(event.streams);
		  }
		 
		  var session   = TB.initSession(sessionId);
		 
		  session.connect(apiKey, token);
		  session.addEventListener("sessionConnected", 
		                           sessionConnectedHandler);
		 
		  session.addEventListener("streamCreated", 
		                           streamCreatedHandler);
		</script>
    </body>
</html>