{% extends "base.html" %}
{% block title %}<title>Nav Pub</title>{% endblock title %}
{% block head_scripts %}
(( super() ))
<script src="/js/TB.min.js" type="text/javascript"></script>
{% endblock head_scripts %}
{% block content %}
<div class="row">
    <div class="small-12 columns">
        <h1>{% block room_title %}Nav Pub{% endblock room_title %}</h1>
    </div>
</div>
{% block tokbox_playback %}{% endblock tokbox_playback %}
<div class="row">
    <div class="small-6 columns">
        <div class="panel">
            <h2>Publishing...<h2>
            <p>
            {% if room_key is defined %}
			    Room Link: http://crowd-navigation.appspot.com/nav-room?g=((room_key))
			{% endif %}
            </p>
        </div>
    </div>
</div>

<script type="text/javascript">
    {% block tokbox_keys %}
    {% if tokbox_token is defined %}
	    var apiKey    = ((tokbox_api_key));
	    var sessionId = ((tokbox_session_id));
	    var token     = ((tokbox_token));
	{% else %}
	    var apiKey    = "44596572";
        var sessionId = "1_MX40NDU5NjU3Mn5-VGh1IEphbiAwOSAwODo0Mzo1OSBQU1QgMjAxNH4wLjM4NTQzOTM0fg";
        var token     = "T1==cGFydG5lcl9pZD00NDU5NjU3MiZzZGtfdmVyc2lvbj10YnJ1YnktdGJyYi12MC45MS4yMDExLTAyLTE3JnNpZz03YjliYjQ3YjZmMmNjNWNlYTU4MWI1ZGQ4M2M3OTkzMGIzNzIxNGUxOnJvbGU9cHVibGlzaGVyJnNlc3Npb25faWQ9MV9NWDQwTkRVNU5qVTNNbjUtVkdoMUlFcGhiaUF3T1NBd09EbzBNem8xT1NCUVUxUWdNakF4Tkg0d0xqTTROVFF6T1RNMGZnJmNyZWF0ZV90aW1lPTEzODkyODU4NDYmbm9uY2U9MC44MTI4NjM0MTQzNDA2NDAxJmV4cGlyZV90aW1lPTEzOTE4Nzc4NTAmY29ubmVjdGlvbl9kYXRhPQ==";
	{% endif %}
    {% endblock tokbox_keys %}
    
    function sessionConnectedHandler (event) {
        session.publish(publisher);
    }
    
    var publisherProperties = {width: 480, height:360, name:{% block stream_name %}"Nav stream"{% endblock stream_name %}};
    var publisher = TB.initPublisher(apiKey, {% block playback %}null{% endblock playback %}, publisherProperties);
    var session = TB.initSession(sessionId);
     
    session.connect(apiKey, token);
    session.addEventListener("sessionConnected", 
                             sessionConnectedHandler);
</script>
{% endblock content %}
